<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Techbuy – Auszahlungsart wählen</title>
  <meta name="description" content="Wählen Sie Ihre bevorzugte Auszahlungsmethode für Ihren Verkaufserlös">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"></noscript>
  
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Konfetti-Bibliothek -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  
  <style>
    :root {
      --primary: #0066FF;
      --primary-dark: #0052CC;
      --primary-light: #E6F0FF;
      --black: #1A1A1A;
      --gray-dark: #333333;
      --gray-medium: #666666;
      --gray-light: #F5F5F5;
      --white: #FFFFFF;
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
      --shadow-hover: 0 8px 32px rgba(0, 0, 0, 0.12);
      --radius: 12px;
      --transition: all 0.3s ease;
      --success: #4CAF50;
      --error: #F44336;
      --warning: #FF9800;
      --paypal: #0070BA;
      --bank: #28A745;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', sans-serif;
      color: var(--black);
      line-height: 1.6;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .container {
      background-color: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 3rem;
      max-width: 500px;
      width: 100%;
      position: relative;
      transform: translateY(20px);
      opacity: 0;
      animation: fadeInUp 0.8s ease forwards;
    }

    @keyframes fadeInUp {
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .security-badge {
      position: absolute;
      top: -15px;
      right: 20px;
      background: linear-gradient(135deg, var(--success), #66BB6A);
      color: white;
      padding: 0.5rem 1.2rem;
      border-radius: 50px;
      font-size: 0.9rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      animation: pulse 2s infinite;
      z-index: 10;
    }

    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
      50% { transform: scale(1.05); box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15); }
      100% { transform: scale(1); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
    }

    h1 { text-align: center; font-size: 1.8rem; margin-bottom: 2rem; }
    h2 { text-align: center; font-size: 1.5rem; margin-bottom: 1rem; }

    .form-group { width: 100%; margin-bottom: 1.5rem; position: relative; }
    .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
    .form-control {
      width: 100%; padding: 0.8rem 1rem; border: 1px solid #ddd;
      border-radius: 8px; font-size: 1rem; transition: var(--transition);
    }
    .form-control:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1); }
    .form-control.error { border-color: var(--error); }
    .form-control.success { border-color: var(--success); }
    
    .error-message {
      color: var(--error);
      font-size: 0.8rem;
      margin-top: 0.3rem;
      display: block;
      opacity: 0;
      transform: translateY(-5px);
      transition: var(--transition);
    }
    
    .error-message.show {
      opacity: 1;
      transform: translateY(0);
    }

    .payment-options {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .payment-option {
      flex: 1;
      border: 2px solid #e0e0e0;
      border-radius: var(--radius);
      padding: 1.5rem 1rem;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      background: var(--white);
    }
    
    .payment-option:hover {
      border-color: var(--primary);
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }
    
    .payment-option.selected {
      border-color: var(--primary);
      background: var(--primary-light);
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }
    
    .payment-icon {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      transition: var(--transition);
    }
    
    .payment-option.selected .payment-icon {
      transform: scale(1.1);
    }
    
    .paypal-icon {
      color: var(--paypal);
    }
    
    .bank-icon {
      color: var(--bank);
    }
    
    .payment-label {
      font-weight: 600;
      font-size: 1rem;
    }

    .progress-container {
      width: 100%;
      height: 8px;
      background-color: #e0e0e0;
      border-radius: 4px;
      margin: 2rem 0;
      overflow: hidden;
      position: relative;
    }
    
    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--primary), var(--primary-dark));
      border-radius: 4px;
      transition: width 0.5s ease;
      position: relative;
      overflow: hidden;
    }
    
    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      background-image: linear-gradient(
        45deg,
        rgba(255, 255, 255, 0.2) 25%,
        transparent 25%,
        transparent 50%,
        rgba(255, 255, 255, 0.2) 50%,
        rgba(255, 255, 255, 0.2) 75%,
        transparent 75%,
        transparent
      );
      background-size: 1rem 1rem;
      animation: move 1s linear infinite;
    }
    
    @keyframes move {
      0% { background-position: 0 0; }
      100% { background-position: 1rem 0; }
    }
    
    .progress-text {
      text-align: center;
      font-size: 0.9rem;
      color: var(--gray-medium);
      margin-top: 0.5rem;
    }

    .cta-button {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark)); 
      color: var(--white); 
      border: none;
      padding: 1rem 2rem; 
      font-size: 1rem; 
      font-weight: 600;
      border-radius: var(--radius); 
      cursor: pointer;
      width: 100%; 
      text-align: center;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 102, 255, 0.3);
    }
    
    .cta-button:hover { 
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 102, 255, 0.4);
    }
    
    .cta-button:active { 
      transform: translateY(0); 
      box-shadow: 0 2px 8px rgba(0, 102, 255, 0.3);
    }
    
    .cta-button:disabled {
      background: var(--gray-medium);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .cta-button::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 5px;
      height: 5px;
      background: rgba(255, 255, 255, 0.5);
      opacity: 0;
      border-radius: 100%;
      transform: scale(1, 1) translate(-50%);
      transform-origin: 50% 50%;
    }
    
    .cta-button:focus:not(:active)::after {
      animation: ripple 1s ease-out;
    }
    
    @keyframes ripple {
      0% {
        transform: scale(0, 0);
        opacity: 0.5;
      }
      100% {
        transform: scale(20, 20);
        opacity: 0;
      }
    }

    .thankyou { 
      text-align: center; 
      padding: 2rem 0; 
      transform: scale(0.8);
      opacity: 0;
      animation: thankYouAppear 0.8s ease 0.5s forwards;
    }
    
    @keyframes thankYouAppear {
      to {
        transform: scale(1);
        opacity: 1;
      }
    }
    
    .confirmation-icon { 
      font-size: 4rem; 
      color: var(--success); 
      margin-bottom: 1.5rem;
      animation: bounceIn 0.8s ease;
    }
    
    @keyframes bounceIn {
      0% { transform: scale(0.3); opacity: 0; }
      50% { transform: scale(1.1); opacity: 1; }
      70% { transform: scale(0.9); }
      100% { transform: scale(1); }
    }

    .hidden { display: none; }

    footer {
      margin-top: 2rem;
      text-align: center;
      font-size: 0.85rem;
      color: var(--gray-medium);
      animation: fadeIn 1s ease 0.5s forwards;
      opacity: 0;
    }
    
    @keyframes fadeIn {
      to { opacity: 1; }
    }
    
    footer a {
      color: var(--primary);
      text-decoration: none;
      margin: 0 10px;
      transition: var(--transition);
      position: relative;
    }
    
    footer a:hover { 
      text-decoration: underline; 
      transform: translateY(-2px); 
    }
    
    footer a::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--primary);
      transition: var(--transition);
    }
    
    footer a:hover::after {
      width: 100%;
    }

    @media (max-width: 768px) {
      .container { padding: 2rem; }
      h1 { font-size: 1.5rem; }
      .payment-options { flex-direction: column; }
    }
    
    @media (max-width: 480px) {
      body { padding: 1rem; }
      .container { padding: 1.5rem; }
      h1 { font-size: 1.3rem; }
    }
    
    /* Floating Background Elements */
    .floating-elements {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }
    
    .floating-element {
      position: absolute;
      background: rgba(0, 102, 255, 0.05);
      border-radius: 50%;
      animation: float 15s infinite linear;
    }
    
    @keyframes float {
      0% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(180deg); }
      100% { transform: translateY(0) rotate(360deg); }
    }
    
    /* Input Animation */
    .form-control {
      position: relative;
      z-index: 1;
    }
    
    .form-control:focus {
      animation: inputFocus 0.5s ease;
    }
    
    @keyframes inputFocus {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
    
    /* Success Checkmark Animation */
    .checkmark {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: block;
      stroke-width: 2;
      stroke: var(--success);
      stroke-miterlimit: 10;
      margin: 0 auto 1.5rem;
      box-shadow: inset 0px 0px 0px var(--success);
      animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
    }
    
    .checkmark__circle {
      stroke-dasharray: 166;
      stroke-dashoffset: 166;
      stroke-width: 2;
      stroke-miterlimit: 10;
      stroke: var(--success);
      fill: none;
      animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
    }
    
    .checkmark__check {
      transform-origin: 50% 50%;
      stroke-dasharray: 48;
      stroke-dashoffset: 48;
      animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
    }
    
    @keyframes stroke {
      100% { stroke-dashoffset: 0; }
    }
    
    @keyframes scale {
      0%, 100% { transform: none; }
      50% { transform: scale3d(1.1, 1.1, 1); }
    }
    
    @keyframes fill {
      100% { box-shadow: inset 0px 0px 0px 40px var(--success); }
    }
    
    /* IBAN Formatierung */
    .iban-hint {
      font-size: 0.75rem;
      color: var(--gray-medium);
      margin-top: 0.3rem;
      display: block;
    }
  </style>
</head>
<body>
  <!-- Floating Background Elements -->
  <div class="floating-elements">
    <div class="floating-element" style="width: 100px; height: 100px; top: 10%; left: 5%;"></div>
    <div class="floating-element" style="width: 150px; height: 150px; top: 70%; left: 80%;"></div>
    <div class="floating-element" style="width: 60px; height: 60px; top: 40%; left: 90%;"></div>
    <div class="floating-element" style="width: 120px; height: 120px; top: 20%; left: 70%;"></div>
    <div class="floating-element" style="width: 80px; height: 80px; top: 80%; left: 10%;"></div>
  </div>

  <div class="container">
    <div class="security-badge">
      <i class="fas fa-lock"></i><span>Sichere Verbindung</span>
    </div>
    
    <!-- Formular -->
    <div id="form-area">
      <h1>Bitte wählen Sie Ihre Auszahlungsart</h1>
      
      <!-- Zahlungsoptionen mit Symbolen -->
      <div class="payment-options">
        <div class="payment-option" data-value="paypal">
          <div class="payment-icon paypal-icon">
            <i class="fab fa-paypal"></i>
          </div>
          <div class="payment-label">PayPal</div>
        </div>
        <div class="payment-option" data-value="bank">
          <div class="payment-icon bank-icon">
            <i class="fas fa-university"></i>
          </div>
          <div class="payment-label">Banküberweisung</div>
        </div>
      </div>
      
      <input type="hidden" id="payment" name="payment" required>
      
      <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
      </div>
      <div class="progress-text" id="progress-text">0% ausgefüllt</div>
      
      <form id="angebot-form" action="https://formsubmit.co/techbuybusiness1@icloud.com" method="POST">
        <!-- Formsubmit Konfiguration -->
        <input type="hidden" name="_subject" value="Auszahlungsart gewählt - Techbuy">
        <input type="hidden" name="_template" value="table">
        <input type="hidden" name="_captcha" value="false">
        <input type="hidden" name="_next" value="#thankyou">

        <!-- E-Mail -->
        <div class="form-group">
          <label for="email">Ihre E-Mail (für Rückfragen)*</label>
          <input type="email" id="email" name="email" class="form-control" required>
          <span class="error-message" id="email-error"></span>
        </div>

        <!-- PayPal Felder -->
        <div id="paypal-fields" class="hidden">
          <div class="form-group">
            <label for="paypal_email">PayPal E-Mail*</label>
            <input type="email" id="paypal_email" name="paypal_email" class="form-control">
            <span class="error-message" id="paypal-email-error"></span>
          </div>
        </div>

        <!-- Bank Felder -->
        <div id="bank-fields" class="hidden">
          <div class="form-group">
            <label for="bank_name">Kontoinhaber*</label>
            <input type="text" id="bank_name" name="bank_name" class="form-control">
            <span class="error-message" id="bank-name-error"></span>
          </div>
          <div class="form-group">
            <label for="iban">IBAN*</label>
            <input type="text" id="iban" name="iban" class="form-control" placeholder="DE89 3704 0044 0532 0130 00" maxlength="27">
            <span class="iban-hint">Die IBAN muss mit DE beginnen und insgesamt 22 Zeichen haben</span>
            <span class="error-message" id="iban-error"></span>
          </div>
        </div>

        <button type="submit" class="cta-button" id="submit-button">
          <i class="fas fa-paper-plane" style="margin-right: 8px;"></i> Absenden
        </button>
      </form>
    </div>

    <!-- Danke-Nachricht -->
    <div id="thankyou" class="hidden thankyou">
      <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
        <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
        <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
      </svg>
      <h2>Vielen Dank!</h2>
      <p>Wir haben Ihre Angaben erfolgreich erhalten.</p>
      <p>Ihr Angebot wird nun bearbeitet – Sie erhalten in Kürze eine Rückmeldung.</p>
    </div>
  </div>

  <!-- Footer mit Impressum/Datenschutz -->
  <footer>
    <a href="impressum.html" target="_blank">Impressum</a> | 
    <a href="datenschutz.html" target="_blank">Datenschutzerklärung</a>
  </footer>

  <script>
    const form = document.getElementById("angebot-form");
    const formArea = document.getElementById("form-area");
    const thankyou = document.getElementById("thankyou");
    const paymentSelect = document.getElementById("payment");
    const paypalFields = document.getElementById("paypal-fields");
    const bankFields = document.getElementById("bank-fields");
    const progressBar = document.getElementById("progress-bar");
    const progressText = document.getElementById("progress-text");
    const submitButton = document.getElementById("submit-button");
    const paymentOptions = document.querySelectorAll('.payment-option');
    const ibanInput = document.getElementById("iban");

    // IBAN automatisch formatieren (Leerzeichen nach je 4 Zeichen)
    function formatIBAN(value) {
      // Nur Buchstaben und Zahlen behalten
      let cleanValue = value.replace(/[^A-Za-z0-9]/g, '').toUpperCase();
      
      // Maximal 27 Zeichen erlauben
      cleanValue = cleanValue.substring(0, 27);
      
      // Nach je 4 Zeichen ein Leerzeichen einfügen
      let formattedValue = '';
      for (let i = 0; i < cleanValue.length; i++) {
        if (i > 0 && i % 4 === 0) {
          formattedValue += ' ';
        }
        formattedValue += cleanValue[i];
      }
      
      return formattedValue;
    }

    // IBAN-Validierungsfunktion - Korrigierte Version
    function validateIBAN(iban) {
      // IBAN bereinigen (Leerzeichen entfernen und in Großbuchstaben umwandeln)
      const cleanIBAN = iban.replace(/\s/g, '').toUpperCase();
      
      // IBAN muss mit DE beginnen und 27 Zeichen lang sein
      if (!cleanIBAN.startsWith('DE') || cleanIBAN.length !== 27) {
        return false;
      }
      
      // IBAN in numerische Form umwandeln
      const rearranged = cleanIBAN.substring(4) + cleanIBAN.substring(0, 4);
      let numericIBAN = '';
      
      for (let i = 0; i < rearranged.length; i++) {
        const char = rearranged.charAt(i);
        if (char >= '0' && char <= '9') {
          numericIBAN += char;
        } else {
          // Buchstaben in Zahlen umwandeln (A=10, B=11, ..., Z=35)
          numericIBAN += (char.charCodeAt(0) - 55).toString();
        }
      }
      
      // Modulo-97-Prüfung durchführen
      let remainder = '';
      for (let i = 0; i < numericIBAN.length; i++) {
        const digit = numericIBAN.charAt(i);
        remainder = (remainder + digit).slice(-9); // Nur die letzten 9 Ziffern behalten
        remainder = (parseInt(remainder, 10) % 97).toString();
      }
      
      return parseInt(remainder, 10) === 1;
    }

    // E-Mail-Validierungsfunktion
    function validateEmail(email) {
      const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
      return re.test(String(email).toLowerCase());
    }

    // Fortschritt berechnen
    function calculateProgress() {
      let progress = 0;
      const totalFields = 2; // E-Mail und Zahlungsart sind immer erforderlich
      let completedFields = 0;
      
      // E-Mail-Feld
      if (document.getElementById("email").value.trim() !== "") {
        completedFields++;
      }
      
      // Zahlungsart
      if (paymentSelect.value !== "") {
        completedFields++;
        
        // Zusätzliche Felder je nach Auswahl
        if (paymentSelect.value === "paypal") {
          if (document.getElementById("paypal_email").value.trim() !== "") {
            completedFields++;
          }
        } else if (paymentSelect.value === "bank") {
          if (document.getElementById("bank_name").value.trim() !== "") {
            completedFields++;
          }
          if (document.getElementById("iban").value.trim() !== "") {
            completedFields++;
          }
        }
      }
      
      progress = Math.round((completedFields / totalFields) * 100);
      progressBar.style.width = `${progress}%`;
      progressText.textContent = `${progress}% ausgefüllt`;
    }

    // Konfetti-Animation
    function triggerConfetti() {
      const count = 300;
      const defaults = {
        origin: { y: 0.7 },
        zIndex: 10000
      };

      function fire(particleRatio, opts) {
        confetti(Object.assign({}, defaults, opts, {
          particleCount: Math.floor(count * particleRatio),
          colors: ['#0066FF', '#0052CC', '#4CAF50', '#FF9800', '#F44336']
        }));
      }

      // Verschiedene Konfetti-Effekte
      fire(0.25, {
        spread: 26,
        startVelocity: 55,
      });
      
      fire(0.2, {
        spread: 60,
      });
      
      fire(0.35, {
        spread: 100,
        decay: 0.91,
        scalar: 0.8
      });
      
      fire(0.1, {
        spread: 120,
        startVelocity: 25,
        decay: 0.92,
        scalar: 1.2
      });
      
      fire(0.1, {
        spread: 120,
        startVelocity: 45,
      });
      
      // Zusätzlicher spezieller Effekt
      setTimeout(() => {
        confetti({
          particleCount: 150,
          angle: 60,
          spread: 55,
          origin: { x: 0 },
          colors: ['#0066FF', '#0052CC', '#4CAF50']
        });
        
        confetti({
          particleCount: 150,
          angle: 120,
          spread: 55,
          origin: { x: 1 },
          colors: ['#0066FF', '#0052CC', '#4CAF50']
        });
      }, 200);
    }

    // IBAN-Eingabe formatieren
    ibanInput.addEventListener('input', function(e) {
      // Cursor-Position speichern
      const cursorPosition = e.target.selectionStart;
      const originalLength = e.target.value.length;
      
      // IBAN formatieren
      e.target.value = formatIBAN(e.target.value);
      
      // Cursor-Position anpassen
      const newLength = e.target.value.length;
      const lengthDifference = newLength - originalLength;
      
      // Cursor-Position berechnen und setzen
      let newCursorPosition = cursorPosition + lengthDifference;
      e.target.setSelectionRange(newCursorPosition, newCursorPosition);
      
      calculateProgress();
    });

    // Formularfelder überwachen
    document.querySelectorAll('input').forEach(field => {
      if (field.id !== 'iban') {
        field.addEventListener('input', calculateProgress);
        field.addEventListener('change', calculateProgress);
      }
    });

    // Zahlungsoptionen auswählen
    paymentOptions.forEach(option => {
      option.addEventListener('click', function() {
        // Alle Optionen zurücksetzen
        paymentOptions.forEach(opt => opt.classList.remove('selected'));
        
        // Ausgewählte Option markieren
        this.classList.add('selected');
        
        // Wert setzen
        paymentSelect.value = this.getAttribute('data-value');
        
        // Felder anzeigen/ausblenden
        paypalFields.classList.add("hidden");
        bankFields.classList.add("hidden");
        document.getElementById("paypal_email").required = false;
        document.getElementById("bank_name").required = false;
        document.getElementById("iban").required = false;

        if (paymentSelect.value === "paypal") {
          paypalFields.classList.remove("hidden");
          document.getElementById("paypal_email").required = true;
        } else if (paymentSelect.value === "bank") {
          bankFields.classList.remove("hidden");
          document.getElementById("bank_name").required = true;
          document.getElementById("iban").required = true;
        }
        
        calculateProgress();
      });
    });

    // Initialen Fortschritt berechnen
    calculateProgress();

    // Formular-Validierung
    function validateForm() {
      let isValid = true;
      
      // E-Mail validieren
      const email = document.getElementById("email");
      const emailError = document.getElementById("email-error");
      if (!validateEmail(email.value)) {
        email.classList.add("error");
        emailError.textContent = "Bitte geben Sie eine gültige E-Mail-Adresse ein";
        emailError.classList.add("show");
        isValid = false;
      } else {
        email.classList.remove("error");
        email.classList.add("success");
        emailError.classList.remove("show");
      }
      
      // Zahlungsart validieren
      if (paymentSelect.value === "") {
        paymentOptions.forEach(option => {
          option.style.borderColor = "var(--error)";
        });
        isValid = false;
      } else {
        paymentOptions.forEach(option => {
          option.style.borderColor = "";
        });
        
        // PayPal-Validierung
        if (paymentSelect.value === "paypal") {
          const paypalEmail = document.getElementById("paypal_email");
          const paypalEmailError = document.getElementById("paypal-email-error");
          if (!validateEmail(paypalEmail.value)) {
            paypalEmail.classList.add("error");
            paypalEmailError.textContent = "Bitte geben Sie eine gültige PayPal-E-Mail-Adresse ein";
            paypalEmailError.classList.add("show");
            isValid = false;
          } else {
            paypalEmail.classList.remove("error");
            paypalEmail.classList.add("success");
            paypalEmailError.classList.remove("show");
          }
        }
        
        // Bank-Validierung
        if (paymentSelect.value === "bank") {
          const bankName = document.getElementById("bank_name");
          const bankNameError = document.getElementById("bank-name-error");
          if (bankName.value.trim() === "") {
            bankName.classList.add("error");
            bankNameError.textContent = "Bitte geben Sie den Kontoinhaber ein";
            bankNameError.classList.add("show");
            isValid = false;
          } else {
            bankName.classList.remove("error");
            bankName.classList.add("success");
            bankNameError.classList.remove("show");
          }
          
          const iban = document.getElementById("iban");
          const ibanError = document.getElementById("iban-error");
          const cleanIBAN = iban.value.replace(/\s/g, '');
          
          if (cleanIBAN.length !== 27) {
            iban.classList.add("error");
            ibanError.textContent = "Die IBAN muss genau 27 Zeichen haben";
            ibanError.classList.add("show");
            isValid = false;
          } else if (!cleanIBAN.startsWith('DE')) {
            iban.classList.add("error");
            ibanError.textContent = "Die IBAN muss mit 'DE' beginnen";
            ibanError.classList.add("show");
            isValid = false;
          } else if (!validateIBAN(cleanIBAN)) {
            iban.classList.add("error");
            ibanError.textContent = "Die IBAN ist ungültig. Bitte überprüfen Sie Ihre Eingabe";
            ibanError.classList.add("show");
            isValid = false;
          } else {
            iban.classList.remove("error");
            iban.classList.add("success");
            ibanError.classList.remove("show");
          }
        }
      }
      
      return isValid;
    }

    // Formular-Übermittlung
    form.addEventListener("submit", async function(e) {
      e.preventDefault();
      
      if (!validateForm()) {
        // Formular animieren, um auf Fehler hinzuweisen
        formArea.style.animation = 'shake 0.5s';
        setTimeout(() => {
          formArea.style.animation = '';
        }, 500);
        return;
      }
      
      // Submit-Button deaktivieren und Ladeanimation anzeigen
      submitButton.disabled = true;
      submitButton.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right: 8px;"></i> Wird gesendet...';
      
      const data = new FormData(form);
      const action = form.getAttribute("action");

      try {
        const response = await fetch(action, {
          method: "POST",
          body: data,
          headers: { 'Accept': 'application/json' }
        });
        
        if (response.ok) {
          // Erfolgreich gesendet - Konfetti und Übergang
          triggerConfetti();
          
          // Verzögerung für visuellen Effekt
          setTimeout(() => {
            formArea.classList.add("hidden");
            thankyou.classList.remove("hidden");
            window.location.hash = '#thankyou';
          }, 1500);
        } else {
          alert("Fehler beim Absenden. Bitte versuchen Sie es erneut.");
          submitButton.disabled = false;
          submitButton.innerHTML = '<i class="fas fa-paper-plane" style="margin-right: 8px;"></i> Absenden';
        }
      } catch (error) {
        alert("Netzwerkfehler. Bitte versuchen Sie es erneut.");
        submitButton.disabled = false;
        submitButton.innerHTML = '<i class="fas fa-paper-plane" style="margin-right: 8px;"></i> Absenden';
      }
    });

    // Shake-Animation für Fehler
    const style = document.createElement('style');
    style.textContent = `
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
        20%, 40%, 60%, 80% { transform: translateX(5px); }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>
